# Tile Server Design Document
The project is currently generating geojson and raster tile files. This means a lot of files, or limited details in zoom level.

A different approach is to generate the tiles on demand via a tile server. 

A commonly used vector and raster tile server is [tileserver-gl](https://github.com/maptiler/tileserver-gl).

It requires us to create `mbtiles` files that `tileserver-gl` will serve. Both for vector (geojson) and raster (filled contour png).

This living document describes the design of such a tileserver setup.

## mbtiles generation

### Raster mbtiles

mbtiles raster can be created from the contourf `1.png` generated by `create_contour`:

```bash
gdal_translate \
  -of MBTILES \
  -a_ullr -180.0  90.0  180.0  -90.0 \
  -a_srs EPSG:4326 \
  1.png \
  1_raster.mbtiles
```

Add zoom levels:
```bash
gdaladdo -r nearest 1_raster.mbtiles 2 4 8 16 32 64 128
```

### Vector mbtiles

Vector tiles are already created as `out.mbtiles` file by `create_contour`.
We only need to rename and store these files in a structured way.

## Client map

On the client side we need to change from geojson tiles to [protobuf vector tiles](https://github.com/mapbox/vector-tile-spec) (`vectorGrid.protobuf` in LeafLet).

